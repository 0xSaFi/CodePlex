SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Screen    
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] dataenvironment
[BASECLASS] dataenvironment
[OBJNAME] Dataenvironment
[START PROPERTIES]
Top = 220
Left = 1
Width = 520
Height = 200
DataSource = .NULL.
Name = "Dataenvironment"
[END PROPERTIES]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED4]
1[END RESERVED4]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWL
[CLASS] form
[BASECLASS] form
[OBJNAME] Form1
[START PROPERTIES]
Top = -3
Left = 23
Height = 352
Width = 516
DoCreate = .T.
ShowTips = .T.
Caption = "Remapping Colors using SetColorKey"
obmp = 0
wbmp = 0
hbmp = 0
_memberdata =      311<VFPData><memberdata name="changecolors" type="method" display="ChangeColors" favorites="False"/><memberdata name="calculateminmax" type="method" display="CalculateMinMax" favorites="False"/><memberdata name="calculaterangeofcolors" type="method" display="CalculateRangeofColors" favorites="False"/></VFPData>

Name = "Form1"
[END PROPERTIES]
[START METHODS]
PROCEDURE calculaterangeofcolors
WITH Thisform.Container1
	lnRGBClr = .Text1.BackColor
	.ShpMin.BackColor = Thisform.ChangeColors(lnRGBClr, - .Spinner1.Value)
	.ShpMax.BackColor = Thisform.ChangeColors(lnRGBClr, .Spinner1.Value)
ENDWITH
ENDPROC
PROCEDURE changecolors
LPARAMETERS tnRGB, tnLevel

IF tnLevel = 0
	RETURN tnRGB
ENDIF

tnLevel = tnLevel / 100

LOCAL lnRed, lnGreen, lnBlue
lnRed   = BITAND(tnRGB, 0x000000FF)
lnGreen = BITRSHIFT(BITAND(tnRGB, 0x0000FF00), 8)
lnBlue  = BITRSHIFT(BITAND(tnRGB, 0x00FF0000), 16)

IF tnLevel > 0
	RETURN RGB( ;
		lnRed   + ((255 - lnRed)   * tnLevel) , ;
		lnGreen + ((255 - lnGreen) * tnLevel) , ;
		lnBlue  + ((255 - lnBlue)  * tnLevel) )
ELSE
	RETURN RGB( ;
		lnRed   + (lnRed   * tnLevel) , ;
		lnGreen + (lnGreen * tnLevel) , ;
		lnBlue  + (lnBlue  * tnLevel) )
ENDIF
ENDPROC
[END METHODS]
[START RESERVED3]
obmp
wbmp
hbmp
_memberdata XML Metadata for customizable properties
*changecolors 
*calculaterangeofcolors 
[END RESERVED3]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TZ0QGKPH
[CLASS] imgcanvas
[CLASSLOC] ..\source\gdiplusx.vcx
[BASECLASS] image
[OBJNAME] Imgcanvas1
[PARENT] Form1
[START PROPERTIES]
Anchor = 45
Stretch = 1
Height = 180
Left = 264
Top = 12
Width = 240
smoothingmode = 3
interpolationmode = 0
Name = "Imgcanvas1"
[END PROPERTIES]
[START METHODS]
PROCEDURE beforedraw
IF EMPTY(Thisform.txtFile.Value)
	RETURN
ENDIF

LOCAL loAttr AS xfcImageAttributes
LOCAL loColorMap as xfcColorMap
LOCAL loOldColor as xfcColor
LOCAL loNewColor as xfcColor

WITH _SCREEN.System.Drawing
	loOldColorMin = .Color.FromRgb(Thisform.Container1.ShpMin.BackColor)
	loOldColorMax = .Color.FromRgb(Thisform.Container1.ShpMax.BackColor)

	loNewColor = .Color.FromRgb(Thisform.Container1.Shape2.BackColor)
	This.Clear(loNewColor)

	loAttr = .Imaging.ImageAttributes.New()
	loAttr.SetColorKey(loOldColorMin, loOldColorMax)
	
	This.oGfx.DrawImage(Thisform.oBmp, This.Rectangle, Thisform.oBmp.GetBounds(), 2, loAttr)
ENDWITH

*** Thisform.oBmp = This.oBmp

#DEFINE OBJ_BITMAP	7
LOCAL hdc, hBitmap
m.hdc = This.HDC
m.hBitmap = GetCurrentObject(m.hdc, OBJ_BITMAP)

WITH Thisform
	.oBmp = _SCREEN.System.Drawing.Image.FromHBitmap(m.hBitmap)
	.wBmp = .oBmp.Width
	.hBmp = .oBmp.Height
ENDWITH

RETURN
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1U40L3TVH
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] txtFile
[PARENT] Form1
[START PROPERTIES]
FontSize = 8
Anchor = 6
Enabled = .F.
Height = 25
Left = 120
Top = 204
Width = 384
DisabledBackColor = 255,255,255
DisabledForeColor = 0,0,0
Name = "txtFile"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1U40LO0FY
[CLASS] image
[BASECLASS] image
[OBJNAME] Image1
[PARENT] Form1
[START PROPERTIES]
Anchor = 135
Stretch = 1
Height = 180
Left = 12
Top = 12
Width = 240
Name = "Image1"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

IF VARTYPE(Thisform.oBmp) <> "O"
	RETURN
ENDIF

X1 = nXCoord - This.Left
Y1 = nYCoord - This.Top

XRatio = Thisform.wBmp / This.Width
YRatio = Thisform.hBmp / This.Height

LOCAL loBitmap as xfcBitmap
loBitmap = Thisform.oBmp

LOCAL loColor as xfcColor
loColor = loBitmap.GetPixel(X1 * xRatio,Y1 * yRatio)
lnRGBClr = RGB(loColor.R, loColor.G, loColor.B)

WITH Thisform.Container1
	.Text1.BackColor = lnRGBClr
	.Shape1.BackColor = lnRGBClr

	Thisform.CalculateRangeofColors()
ENDWITH
ENDPROC
PROCEDURE MouseLeave
LPARAMETERS nButton, nShift, nXCoord, nYCoord
Thisform.Container1.Text1.BackColor = Thisform.Container1.Shape1.BackColor
ENDPROC
PROCEDURE MouseMove
LPARAMETERS nButton, nShift, nXCoord, nYCoord

IF VARTYPE(Thisform.oBmp) <> "O"
	RETURN
ENDIF

X1 = nXCoord - This.Left
Y1 = nYCoord - This.Top

XRatio = Thisform.wBmp / This.Width
YRatio = Thisform.hBmp / This.Height

WITH _SCREEN.System.Drawing
	LOCAL loBitmap as xfcBitmap
	loBitmap = Thisform.oBmp

	LOCAL loColor as xfcColor
	loColor = loBitmap.GetPixel(X1 * xRatio,Y1 * yRatio)
	lnRGBClr = RGB(loColor.R, loColor.G, loColor.B)

	Thisform.Container1.Text1.BackColor = lnRGBClr
ENDWITH

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1U40NTQI6
[CLASS] container
[BASECLASS] container
[OBJNAME] Container1
[PARENT] Form1
[START PROPERTIES]
Anchor = 6
Top = 252
Left = 12
Width = 408
Height = 96
SpecialEffect = 0
Visible = .F.
Name = "Container1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1V81F5AU2
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] Command7
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 60
Left = 300
Height = 25
Width = 98
Anchor = 12
Caption = "Change Colors"
Name = "Command7"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.ImgCanvas1.Draw()
Thisform.Image1.PictureVal = Thisform.Imgcanvas1.PictureVal
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] shape
[BASECLASS] shape
[OBJNAME] Shape1
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 24
Left = 12
Height = 60
Width = 60
Name = "Shape1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VA0OJPIR
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] Text1
[PARENT] Form1.Container1
[START PROPERTIES]
Height = 37
Left = 24
SpecialEffect = 1
Top = 36
Width = 36
Name = "Text1"
[END PROPERTIES]
[START METHODS]
PROCEDURE When
RETURN .F.

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWL
[CLASS] label
[BASECLASS] label
[OBJNAME] Label1
[PARENT] Form1.Container1
[START PROPERTIES]
Caption = "Original Color"
Height = 17
Left = 12
Top = 4
Width = 84
Name = "Label1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] shape
[BASECLASS] shape
[OBJNAME] Shape2
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 24
Left = 216
Height = 60
Width = 60
Name = "Shape2"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.BackColor = GETCOLOR()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] label
[BASECLASS] label
[OBJNAME] Label2
[PARENT] Form1.Container1
[START PROPERTIES]
Caption = "New Color"
Height = 17
Left = 216
Top = 4
Width = 84
Name = "Label2"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Shape2.Click()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB011PW4
[CLASS] shape
[BASECLASS] shape
[OBJNAME] shpMin
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 24
Left = 84
Height = 24
Width = 24
Name = "shpMin"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.BackColor = GETCOLOR()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB011PW5
[CLASS] shape
[BASECLASS] shape
[OBJNAME] shpMax
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 60
Left = 84
Height = 24
Width = 24
Name = "shpMax"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.BackColor = GETCOLOR()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB011PW6
[CLASS] spinner
[BASECLASS] spinner
[OBJNAME] Spinner1
[PARENT] Form1.Container1
[START PROPERTIES]
Height = 24
Increment =   1.00
KeyboardHighValue = 100
KeyboardLowValue = 0
Left = 120
SpinnerHighValue = 100.00
SpinnerLowValue =   0.00
Top = 24
Width = 42
Value = 10
Name = "Spinner1"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
Thisform.CalculateMinMax()

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB028DUC
[CLASS] label
[BASECLASS] label
[OBJNAME] Label3
[PARENT] Form1.Container1
[START PROPERTIES]
Caption = "%"
Height = 17
Left = 165
Top = 24
Width = 12
Name = "Label3"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Shape2.Click()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] Command2
[PARENT] Form1
[START PROPERTIES]
Top = 204
Left = 12
Height = 25
Width = 98
Anchor = 6
Picture = (home() + "/graphics/bitmaps/outline/open.bmp")
Caption = "Get Picture"
PicturePosition = 1
PictureSpacing = 1
Name = "Command2"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
lcFile = GETPICT()
IF EMPTY(lcFile)
	RETURN
ENDIF

WITH Thisform
	.Container1.Visible = .T.
	.txtFile.Value = lcFile
	.Image1.Picture = lcFile
	.obmp = _Screen.System.Drawing.Bitmap.New(Thisform.txtFile.Value)
	.wBmp = .oBmp.Width
	.hBmp = .oBmp.Height
ENDWITH
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1V91FF99H
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] Command1
[PARENT] Form1
[START PROPERTIES]
Top = 324
Left = 480
Height = 25
Width = 26
Anchor = 12
Picture = (home() + "/samples/solution/bts.bmp")
Caption = ""
ToolTipText = 'Select an image; Go with your mouse over the left picture, and click in any color; Click "NewColor", select the color that will substitute the original; The spinner determines the color range to apply transformation; Click "Change Colors"'
PicturePosition = 1
PictureSpacing = 1
Name = "Command1"
[END PROPERTIES]
[START METHODS]
PROCEDURE Destroy
_TOOLTIPTIMEOUT = This.nOriginalToolTipTime
ENDPROC
PROCEDURE Init
This.AddProperty("nOriginalToolTipTime",0)
This.nOriginalToolTipTime = _TOOLTIPTIMEOUT
_TOOLTIPTIMEOUT = 0
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 0, 8, 5, 14, 11, 29, 3, 0
[END PROPERTIES]
[EOF]
