SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Screen    
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] dataenvironment
[BASECLASS] dataenvironment
[OBJNAME] Dataenvironment
[START PROPERTIES]
Top = 220
Left = 1
Width = 520
Height = 200
DataSource = .NULL.
Name = "Dataenvironment"
[END PROPERTIES]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED4]
1[END RESERVED4]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWL
[CLASS] form
[BASECLASS] form
[OBJNAME] Form1
[START PROPERTIES]
Top = -3
Left = 23
Height = 509
Width = 712
ShowWindow = 2
DoCreate = .T.
ShowTips = .T.
Caption = "Playing with logos using ImageAttributes"
MinHeight = 500
MinWidth = 500
obmp = 0
wbmp = 0
hbmp = 0
_memberdata =      471<VFPData><memberdata name="changecolors" type="method" display="ChangeColors" favorites="False"/><memberdata name="calculateminmax" type="method" display="CalculateMinMax" favorites="False"/><memberdata name="calculaterangeofcolors" type="method" display="CalculateRangeofColors" favorites="False"/><memberdata name="loadlogo" type="method" display="LoadLogo" favorites="False"/><memberdata name="loadmain" type="method" display="LoadMain" favorites="False"/></VFPData>

obmplogo = 0
hbmplogo = 0
wbmplogo = .F.
Name = "Form1"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
DODEFAULT()
RETURN


LOCAL lcMainImage, lcLogoImage

lcMainImage = "\samples\desert.jpg"
lcLogoImage = "\samples\craigfoxprologo2.png"

Thisform.TxtFile.Value = lcMainImage
Thisform.Image1.Picture = lcMainImage

Thisform.TxtLogoFile.Value = lcLogoImage
Thisform.Image2.Picture = lcLogoImage

Thisform.LoadMain()
Thisform.LoadLogo()

Thisform.CalculateRangeofColors()
Thisform.ImgCanvas1.Draw()
ENDPROC
PROCEDURE calculaterangeofcolors
WITH Thisform.Container1
	lnRGBClr = .Text1.BackColor
	.ShpMin.BackColor = Thisform.ChangeColors(lnRGBClr, - .Spinner1.Value)
	.ShpMax.BackColor = Thisform.ChangeColors(lnRGBClr, .Spinner1.Value)
ENDWITH
ENDPROC
PROCEDURE changecolors
LPARAMETERS tnRGB, tnLevel

IF tnLevel = 0
	RETURN tnRGB
ENDIF

tnLevel = tnLevel / 100

LOCAL lnRed, lnGreen, lnBlue
lnRed   = BITAND(tnRGB, 0x000000FF)
lnGreen = BITRSHIFT(BITAND(tnRGB, 0x0000FF00), 8)
lnBlue  = BITRSHIFT(BITAND(tnRGB, 0x00FF0000), 16)

IF tnLevel > 0
	RETURN RGB( ;
		lnRed   + ((255 - lnRed)   * tnLevel) , ;
		lnGreen + ((255 - lnGreen) * tnLevel) , ;
		lnBlue  + ((255 - lnBlue)  * tnLevel) )
ELSE
	RETURN RGB( ;
		lnRed   + (lnRed   * tnLevel) , ;
		lnGreen + (lnGreen * tnLevel) , ;
		lnBlue  + (lnBlue  * tnLevel) )
ENDIF
ENDPROC
PROCEDURE loadlogo
WITH Thisform
	.obmpLogo = _Screen.System.Drawing.Bitmap.New(Thisform.txtLogoFile.Value)
	.wBmpLogo = .oBmpLogo.Width
	.hBmpLogo = .oBmpLogo.Height
ENDWITH
ENDPROC
PROCEDURE loadmain
WITH Thisform
	.obmp = _Screen.System.Drawing.Bitmap.New(Thisform.txtFile.Value)
	.wBmp = .oBmp.Width
	.hBmp = .oBmp.Height
ENDWITH
ENDPROC
[END METHODS]
[START RESERVED3]
obmp
wbmp
hbmp
_memberdata XML Metadata for customizable properties
obmplogo
hbmplogo
wbmplogo
*changecolors 
*calculaterangeofcolors 
*loadlogo 
*loadmain 
[END RESERVED3]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TZ0QGKPH
[CLASS] imgcanvas
[CLASSLOC] ..\..\..\vfpx-2859\vfpx\gdiplusx\source\gdiplusx.vcx
[BASECLASS] image
[OBJNAME] Imgcanvas1
[PARENT] Form1
[START PROPERTIES]
Anchor = 15
Stretch = 1
Height = 396
Left = 168
Top = 84
Width = 540
smoothingmode = 3
interpolationmode = 0
Name = "Imgcanvas1"
[END PROPERTIES]
[START METHODS]
PROCEDURE beforedraw
IF EMPTY(Thisform.txtFile.Value)
	RETURN
ENDIF

LOCAL loAttr AS xfcImageAttributes
LOCAL loOldColor as xfcColor
LOCAL loNewColor as xfcColor

This.Clear()

WITH _SCREEN.System.Drawing

	*!*	Draw the main image
	This.oGfx.DrawImage(Thisform.oBmp, This.Rectangle)
	
	
	
	*!* Example 1
	*!* Original Image
	*!* Position : Top Left
	*!* Draw Logo without any transformation
	This.oGfx.DrawImage(Thisform.oBmpLogo, 0, 0)


	*!* Example 2
	*!* Logo Image with 50% transparency
	*!* Position : Top Right
	*!* The position (4,4) of the matrix is responsible for the opacity

	LOCAL loClrMatrix AS xfcColorMatrix
	loClrMatrix = .Imaging.ColorMatrix.New( ;
        1, 0, 0, 0  , 0, ;
        0, 1, 0, 0  , 0, ;
        0, 0, 1, 0  , 0, ;
        0, 0, 0, 0.5, 0, ;
        0, 0, 0, 0  , 0)

	loAttr = .Imaging.ImageAttributes.New()
	loAttr.SetColorMatrix(loClrMatrix)
	LOCAL loRect as xfcRectangle
	loRect = _Screen.System.Drawing.Rectangle.New(Thisform.oBmpLogo.Width, Thisform.oBmpLogo.Height)
	loRect.X = This.Width - Thisform.wbmplogo
	loRect.Y = 0
	loRect.Width  = Thisform.wbmplogo
	loRect.Height = Thisform.hbmplogo
	
	This.oGfx.DrawImage(Thisform.oBmpLogo, loRect, Thisform.oBmpLogo.GetBounds(), 2, loAttr)
	loAttr = NULL
	

	*!* Example 3
	*!* Logo Image with NO transparency
	*!* Convert selected color with ALPHA 255 (Opaque) to TRANSPARENT ALPHA (0)
	*!* Position : Bottom Left
	loOldColorMin = .Color.FromRgb(Thisform.Container1.ShpMin.BackColor)
	loOldColorMax = .Color.FromRgb(Thisform.Container1.ShpMax.BackColor)

	loAttr = .Imaging.ImageAttributes.New()
	loAttr.SetColorKey(loOldColorMin, loOldColorMax)
	loRect.X = 0
	loRect.Y = This.Height - Thisform.hBmplogo
	loRect.Width  = Thisform.wbmplogo
	loRect.Height = Thisform.hbmplogo

	This.oGfx.DrawImage(Thisform.oBmpLogo, loRect, Thisform.oBmpLogo.GetBounds(), 2, loAttr)
	loAttr = NULL


	*!* Example 4
	*!* Image with 50% transparency using ColorMAtrix
	*!* Convert selected color with ALPHA 255 (Opaque) to TRANSPARENT ALPHA (0)
	*!* Position : Bottom Right

	loAttr = .Imaging.ImageAttributes.New()
	loAttr.SetColorMatrix(loClrMatrix)
	loAttr.SetColorKey(loOldColorMin, loOldColorMax)

	loRect.X = This.Width - Thisform.wbmplogo
	loRect.Y = This.Height - Thisform.hBmplogo
	loRect.Width  = Thisform.wbmplogo
	loRect.Height = Thisform.hbmplogo
	This.oGfx.DrawImage(Thisform.oBmpLogo, loRect, Thisform.oBmpLogo.GetBounds(), 2, loAttr)
	loAttr = NULL


ENDWITH


RETURN
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] txtFile
[PARENT] Form1
[START PROPERTIES]
FontSize = 8
Anchor = 11
Enabled = .F.
Height = 25
Left = 120
TabIndex = 2
Top = 12
Width = 588
DisabledBackColor = 255,255,255
DisabledForeColor = 0,0,0
Name = "txtFile"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] image
[BASECLASS] image
[OBJNAME] Image2
[PARENT] Form1
[START PROPERTIES]
Anchor = 3
Stretch = 2
Height = 96
Left = 12
Top = 192
Width = 132
Name = "Image2"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

IF VARTYPE(Thisform.oBmpLogo) <> "O"
	RETURN
ENDIF

X1 = nXCoord - This.Left
Y1 = nYCoord - This.Top

XRatio = Thisform.wBmpLogo / This.Width
YRatio = Thisform.hBmpLogo / This.Height

LOCAL loBitmap as xfcBitmap
loBitmap = Thisform.oBmpLogo

LOCAL loColor as xfcColor
loColor = loBitmap.GetPixel(X1 * xRatio,Y1 * yRatio)
lnRGBClr = RGB(loColor.R, loColor.G, loColor.B)

WITH Thisform.Container1
	.Text1.BackColor = lnRGBClr
	.Shape1.BackColor = lnRGBClr

	Thisform.CalculateRangeofColors()
ENDWITH
ENDPROC
PROCEDURE MouseLeave
LPARAMETERS nButton, nShift, nXCoord, nYCoord
Thisform.Container1.Text1.BackColor = Thisform.Container1.Shape1.BackColor
ENDPROC
PROCEDURE MouseMove
LPARAMETERS nButton, nShift, nXCoord, nYCoord

IF VARTYPE(Thisform.oBmpLogo) <> "O"
	RETURN
ENDIF

X1 = nXCoord - This.Left
Y1 = nYCoord - This.Top

XRatio = Thisform.wBmpLogo / This.Width
YRatio = Thisform.hBmpLogo / This.Height

WITH _SCREEN.System.Drawing
	LOCAL loBitmap as xfcBitmap
	loBitmap = Thisform.oBmpLogo

	LOCAL loColor as xfcColor
	loColor = loBitmap.GetPixel(X1 * xRatio,Y1 * yRatio)
	lnRGBClr = RGB(loColor.R, loColor.G, loColor.B)

	Thisform.Container1.Text1.BackColor = lnRGBClr
ENDWITH

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1U40NTQI6
[CLASS] container
[BASECLASS] container
[OBJNAME] Container1
[PARENT] Form1
[START PROPERTIES]
Anchor = 6
Top = 300
Left = 12
Width = 132
Height = 180
SpecialEffect = 0
Visible = .T.
TabIndex = 5
Name = "Container1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1V81F5AU2
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdDraw
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 144
Left = 12
Height = 25
Width = 98
Anchor = 12
Caption = "Draw Logos"
TabIndex = 2
Name = "cmdDraw"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
IF EMPTY(Thisform.TxtFile.Value) OR EMPTY(Thisform.TxtLogoFile.Value)
	MESSAGEBOX("Picutes were not loaded !",48,"VFP-X GDI+ classes")
	RETURN
ENDIF
Thisform.CalculateRangeofColors()
Thisform.ImgCanvas1.Draw()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWK
[CLASS] shape
[BASECLASS] shape
[OBJNAME] Shape1
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 24
Left = 12
Height = 60
Width = 60
BackColor = 255,255,255
Name = "Shape1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VA0OJPIR
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] Text1
[PARENT] Form1.Container1
[START PROPERTIES]
Height = 37
Left = 24
SpecialEffect = 1
TabIndex = 3
Top = 36
Width = 36
Name = "Text1"
[END PROPERTIES]
[START METHODS]
PROCEDURE When
RETURN .F.

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWL
[CLASS] label
[BASECLASS] label
[OBJNAME] Label1
[PARENT] Form1.Container1
[START PROPERTIES]
Caption = "Original Color"
Height = 17
Left = 12
Top = 4
Width = 84
TabIndex = 4
Name = "Label1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB011PW4
[CLASS] shape
[BASECLASS] shape
[OBJNAME] shpMin
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 24
Left = 84
Height = 24
Width = 24
Name = "shpMin"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.BackColor = GETCOLOR()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB011PW5
[CLASS] shape
[BASECLASS] shape
[OBJNAME] shpMax
[PARENT] Form1.Container1
[START PROPERTIES]
Top = 60
Left = 84
Height = 24
Width = 24
Name = "shpMax"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.BackColor = GETCOLOR()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB011PW6
[CLASS] spinner
[BASECLASS] spinner
[OBJNAME] Spinner1
[PARENT] Form1.Container1
[START PROPERTIES]
Height = 24
Increment =   1.00
KeyboardHighValue = 100
KeyboardLowValue = 0
Left = 12
SpinnerHighValue = 100.00
SpinnerLowValue =   0.00
TabIndex = 1
Top = 96
Width = 50
Value = 10
Name = "Spinner1"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
Thisform.CalculateRangeofColors()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB028DUC
[CLASS] label
[BASECLASS] label
[OBJNAME] Label3
[PARENT] Form1.Container1
[START PROPERTIES]
Caption = "%"
Height = 17
Left = 65
Top = 96
Width = 12
TabIndex = 5
Name = "Label3"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Shape2.Click()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1TP0L3VWL
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] Command2
[PARENT] Form1
[START PROPERTIES]
Top = 12
Left = 12
Height = 25
Width = 98
FontSize = 8
Anchor = 3
Picture = (home() + "/graphics/bitmaps/outline/open.bmp")
Caption = "Main Picture"
TabIndex = 1
PicturePosition = 1
PictureSpacing = 1
Name = "Command2"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
lcFile = GETPICT()
IF EMPTY(lcFile)
	RETURN
ENDIF

Thisform.txtFile.Value = lcFile
Thisform.Image1.Picture = lcFile
Thisform.LoadMain()


ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1V91FF99H
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] Command1
[PARENT] Form1
[START PROPERTIES]
Top = 482
Left = 682
Height = 25
Width = 26
Anchor = 12
Picture = (home() + "/samples/solution/bts.bmp")
Caption = ""
TabIndex = 6
ToolTipText = 'Select "Main or background picture"; Select "Logo Picture"; Go with your mouse over the logo picture, and click in any color to make it transparent ; The spinner determines the color range to apply transformation; Click "Draw Logos"'
PicturePosition = 1
PictureSpacing = 1
Name = "Command1"
[END PROPERTIES]
[START METHODS]
PROCEDURE Destroy
_TOOLTIPTIMEOUT = This.nOriginalToolTipTime
ENDPROC
PROCEDURE Init
This.AddProperty("nOriginalToolTipTime",0)
This.nOriginalToolTipTime = _TOOLTIPTIMEOUT
_TOOLTIPTIMEOUT = 0
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB0YDZYY
[CLASS] image
[BASECLASS] image
[OBJNAME] Image1
[PARENT] Form1
[START PROPERTIES]
Anchor = 3
Stretch = 2
Height = 96
Left = 12
Top = 84
Width = 132
Name = "Image1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB0YDZYZ
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] txtLogoFile
[PARENT] Form1
[START PROPERTIES]
FontSize = 8
Anchor = 11
Enabled = .F.
Height = 25
Left = 120
TabIndex = 4
Top = 48
Width = 588
DisabledBackColor = 255,255,255
DisabledForeColor = 0,0,0
Name = "txtLogoFile"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _1VB0YDZZ0
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] Command3
[PARENT] Form1
[START PROPERTIES]
Top = 48
Left = 12
Height = 25
Width = 98
FontSize = 8
Anchor = 3
Picture = (home() + "/graphics/bitmaps/outline/open.bmp")
Caption = "Logo Picture"
TabIndex = 3
PicturePosition = 1
PictureSpacing = 1
Name = "Command3"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
lcFile = GETPICT()
IF EMPTY(lcFile)
	RETURN
ENDIF

Thisform.txtLogoFile.Value = lcFile
Thisform.Image2.Picture = lcFile
Thisform.LoadLogo()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 0, 8, 5, 14, 11, 29, 3, 0
[END PROPERTIES]
[EOF]
